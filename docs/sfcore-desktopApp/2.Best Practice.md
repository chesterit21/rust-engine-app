# RULES

Berikut adalah **aturan Best Practice** agar aplikasi Rust berbasis eGUI + PostgreSQL yang kita bangun memiliki **performa optimal**, **resource usage rendah**, dan **ukuran binary kecil saat publish**, lengkap dengan referensi resmi untuk setiap poin:

***

## âœ… **1. Optimasi Performa Aplikasi**

### **a. Gunakan Async Non-Blocking I/O**

* Gunakan **Tokio** untuk semua operasi DB dan event UI agar tidak memblokir thread utama.
* Hindari `std::thread::sleep` atau blocking calls.
* Pastikan query SQL menggunakan **prepared statements** untuk mengurangi overhead.

**Referensi:**

* <https://tokio.rs/>
* <https://docs.rs/sqlx/latest/sqlx/>

***

### **b. Minimalkan Redraw UI**

* Gunakan `ctx.request_repaint()` hanya saat state berubah.
* Hindari loop animasi yang terus-menerus memanggil repaint tanpa kondisi.

**Referensi:**

* <https://docs.rs/egui/latest/egui/#performance>

***

### **c. Gunakan Pooling untuk Database**

* Gunakan `PgPool` dengan koneksi terbatas (misal `max_connections = 5`).
* Jangan buat koneksi baru setiap kali login, gunakan pool yang sudah ada.

**Referensi:**

* <https://docs.rs/sqlx/latest/sqlx/pool/index.html>

***

### **d. Hindari Allocasi Berlebihan**

* Gunakan `String::with_capacity()` untuk buffer yang sering digunakan.
* Hindari cloning data besar, gunakan `Arc` atau `&str` jika memungkinkan.

**Referensi:**

* <https://nnethercote.github.io/perf-book/>

***

## âœ… **2. Optimasi Resource Usage**

### **a. Gunakan Release Mode**

* Compile dengan `--release` untuk optimasi penuh:

```bash
cargo build --release
```

**Referensi:**

* <https://doc.rust-lang.org/cargo/reference/profiles.html>

***

### **b. Hindari Thread Berlebihan**

* Gunakan **Tokio tasks** daripada membuat banyak OS thread.
* Pastikan animasi berjalan di UI thread, bukan spawn thread baru.

**Referensi:**

* <https://docs.rs/tokio/latest/tokio/task/index.html>

***

### **c. Gunakan Lazy Initialization**

* Inisialisasi koneksi DB hanya saat login diperlukan.
* Jangan load semua menu sekaligus, gunakan **lazy loading**.

**Referensi:**

* <https://doc.rust-lang.org/std/lazy/index.html>

***

## âœ… **3. Optimasi Ukuran Binary**

### **a. Strip Symbols**

* Gunakan `strip` untuk menghapus simbol debug:

```bash
strip target/release/your_app
```

**Referensi:**

* <https://sourceware.org/binutils/docs/binutils/strip.html>

***

### **b. Gunakan LTO (Link Time Optimization)**

* Tambahkan di `Cargo.toml`:

```toml
[profile.release]
lto = true
codegen-units = 1
opt-level = "z" # fokus ukuran kecil
```

**Referensi:**

* <https://doc.rust-lang.org/cargo/reference/profiles.html#lto>

***

### **c. Gunakan `opt-level = "z"`**

* Optimasi untuk ukuran kecil, bukan kecepatan.
* Bisa digabung dengan `panic = "abort"` untuk mengurangi overhead.

```toml
[profile.release]
panic = "abort"
```

**Referensi:**

* <https://doc.rust-lang.org/cargo/reference/profiles.html#opt-level>

***

### **d. Gunakan `cargo-bloat` untuk Analisis**

* Install:

```bash
cargo install cargo-bloat
```

* Jalankan:

```bash
cargo bloat --release --crates
```

Untuk melihat crate mana yang paling besar.

**Referensi:**

* <https://github.com/RazrFalcon/cargo-bloat>

***

## âœ… **4. Best Practice Tambahan**

* **Gunakan Feature Flags**: Aktifkan hanya fitur yang diperlukan di crate (misal `sqlx` tanpa `mysql`).
* **Minimalkan Dependencies**: Hindari crate besar jika hanya butuh fungsi kecil.
* **Gunakan Static Linking**: Untuk distribusi cross-platform, gunakan `musl` target:

```bash
rustup target add x86_64-unknown-linux-musl
cargo build --release --target x86_64-unknown-linux-musl
```

**Referensi:**

* <https://doc.rust-lang.org/rustc/platform-support.html>

***

## âœ… **Checklist Final untuk Publish**

âœ” Compile dengan `--release`  
âœ” Aktifkan LTO + opt-level = "z"  
âœ” Strip binary  
âœ” Gunakan `panic = "abort"`  
âœ” Analisis dengan `cargo-bloat`  
âœ” Minimalkan dependencies

***

ðŸ“Œ **Referensi Lengkap:**

* <https://nnethercote.github.io/perf-book/>
* <https://doc.rust-lang.org/cargo/reference/profiles.html>
* <https://tokio.rs/>
* <https://docs.rs/sqlx/latest/sqlx/>
* <https://docs.rs/egui/latest/egui/#performance>
* <https://github.com/RazrFalcon/cargo-bloat>

***
