# RAG API Server - API JSON Payload Specification

Dokumen ini berisi pemetaan lengkap struktur JSON (Payload) untuk setiap endpoint di RAG API Server.

## 1. Security Headers (Wajib)

Semua endpoint (kecuali `/health`) memerlukan header berikut:

| Header | Deskripsi | Contoh |
| --- | --- | --- |
| `X-App-ID` | ID Aplikasi Client | `DMS-CLIENT-APP-2026` |
| `X-API-Key` | API Key Rahasia | `your-secret-api-key-here-change-me` |
| `X-Request-Timestamp` | Unix Timestamp (Detik) | `1706170000` |
| `X-Request-Signature` | HMAC-SHA256 (API Key, AppID + Timestamp) | `a1b2c3d4...` |

---

## 2. Endpoints Payload

### A. Chat Init (Consolidated)

- **URL**: `POST /api/chat/init`
- **Request**:

```json
{
  "user_id": 123,
  "session_id": 1706170000123 // Optional
}
```

- **Response**:

```json
{
  "session_id": 1706170000123,
  "documents": [
    {
      "document_id": 45,
      "title": "Laporan_A.pdf",
      "owner_user_id": 123,
      "permission_level": "owner",
      "created_at": "2024-01-25T15:00:00Z"
    }
  ]
}
```

### B. Session Events (SSE)

- **URL**: `GET /api/chat/events?session_id=...`
- **Event Name**: `system_event`
- **Data (JSON)**:

```json
{
  "type": "processing_completed",
  "payload": {
    "document_id": 46,
    "chunks_count": 20
  }
}
```

### C. Chat Stream (SSE)

- **URL**: `POST /api/chat/stream`
- **Request**:

```json
{
  "user_id": 123,
  "session_id": 1706170000123,
  "message": "Halo",
  "document_id": null
}
```

### D. Upload Document (Async)

- **URL**: `POST /api/upload`
- **Type**: `multipart/form-data`
- **Fields**: `user_id`, `session_id`, `file`
- **Response**:

```json
{
  "success": true,
  "message": "File received and is being processed in the background",
  "document_id": null,
  "chunks_created": 0
}
```

### E. Search Documents

- **URL**: `POST /api/search`
- **Request**:

```json
{
  "user_id": 123,
  "query": "Keyphrase",
  "document_id": null,
  "limit": 10
}
```

### F. Stats & Cleanup

- `GET /api/chat/stats`
- `GET /api/chat/logs/stats`
- `POST /api/chat/cleanup`
