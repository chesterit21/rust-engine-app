### INFO SCHEMA TABLE

```sql
CREATE TABLE rag_document_chunks(
    id SERIAL NOT NULL,
    document_id integer NOT NULL,
    tenant_id integer,
    chunk_index integer NOT NULL,
    content text NOT NULL,
    char_count integer NOT NULL,
    token_count integer,
    content_tsv tsvector GENERATED ALWAYS AS to_tsvector('indonesian'::regconfig, content) STORED,
    embedding vector NOT NULL,
    page_number integer,
    section text,
    tags text[],
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    PRIMARY KEY(id)
);
CREATE UNIQUE INDEX unique_document_chunk ON public.rag_document_chunks USING btree (document_id, chunk_index);
CREATE INDEX idx_rag_chunks_tsv ON public.rag_document_chunks USING gin (content_tsv);
CREATE INDEX idx_rag_chunks_document ON public.rag_document_chunks USING btree (document_id);
CREATE INDEX idx_rag_chunks_tenant ON public.rag_document_chunks USING btree (tenant_id) WHERE (tenant_id IS NOT NULL);
CREATE INDEX idx_rag_chunks_tags ON public.rag_document_chunks USING gin (tags) WHERE (tags IS NOT NULL);
CREATE INDEX idx_rag_chunks_embedding_hnsw ON public.rag_document_chunks USING hnsw (embedding vector_cosine_ops) WITH (m='16', ef_construction='64');
CREATE INDEX idx_rag_chunks_embedding ON public.rag_document_chunks USING ivfflat (embedding vector_cosine_ops) WITH (lists='100');
CREATE INDEX idx_rag_chunks_doc_id ON public.rag_document_chunks USING btree (document_id);
CREATE INDEX idx_rag_chunks_content_fts ON public.rag_document_chunks USING gin (to_tsvector('english'::regconfig, content));


-- Generated by the database client.
CREATE TABLE rag_document_metadata(
    document_id integer NOT NULL,
    auto_summary text,
    summary_generated_at timestamp with time zone DEFAULT now(),
    summary_token_count integer,
    topics text[],
    language varchar(10),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    PRIMARY KEY(document_id),
    CONSTRAINT fk_document_metadata_document FOREIGN key(document_id) REFERENCES "TblDocuments"("Id")
);
CREATE INDEX idx_metadata_document_id ON public.rag_document_metadata USING btree (document_id);
CREATE INDEX idx_metadata_has_summary ON public.rag_document_metadata USING btree (auto_summary) WHERE (auto_summary IS NOT NULL);
COMMENT ON TABLE rag_document_metadata IS 'AI-generated metadata for documents. Separate table to avoid altering production TblDocuments.';
```

```sql
-- Generated by the database client.
CREATE TABLE rag_document_processing(
    document_id integer NOT NULL,
    status varchar(50) NOT NULL,
    progress double precision NOT NULL DEFAULT 0,
    message text,
    updated_at timestamp with time zone DEFAULT now(),
    PRIMARY KEY(document_id)
);

-- Generated by the database client.
CREATE TABLE rag_ingestion_log(
    document_id integer NOT NULL,
    file_path text NOT NULL,
    file_size bigint,
    file_type varchar(255),
    embedding_model text NOT NULL,
    chunk_size integer NOT NULL,
    chunk_overlap integer NOT NULL,
    status varchar(20) NOT NULL DEFAULT 'pending'::character varying,
    total_chunks integer DEFAULT 0,
    processed_chunks integer DEFAULT 0,
    last_error text,
    retry_count integer DEFAULT 0,
    started_at timestamp with time zone,
    processed_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    PRIMARY KEY(document_id)
);
CREATE INDEX idx_ingestion_log_status ON public.rag_ingestion_log USING btree (status);
CREATE INDEX idx_ingestion_log_updated ON public.rag_ingestion_log USING btree (updated_at);

-- Generated by the database client.
CREATE TABLE tbl_activity_logs(
    log_id SERIAL NOT NULL,
    session_id bigint NOT NULL,
    user_id bigint NOT NULL,
    activity_type varchar(50) NOT NULL,
    activity_status varchar(20) NOT NULL,
    document_id bigint,
    message_content text,
    response_content text,
    token_count integer,
    retrieval_skipped boolean DEFAULT false,
    similarity_score double precision,
    processing_time_ms integer,
    llm_call_duration_ms integer,
    retrieval_duration_ms integer,
    error_message text,
    error_type varchar(100),
    user_agent text,
    ip_address inet,
    created_at timestamp with time zone NOT NULL DEFAULT now(),
    PRIMARY KEY(log_id)
);
CREATE INDEX idx_activity_logs_session_id ON public.tbl_activity_logs USING btree (session_id);
CREATE INDEX idx_activity_logs_user_id ON public.tbl_activity_logs USING btree (user_id);
CREATE INDEX idx_activity_logs_activity_type ON public.tbl_activity_logs USING btree (activity_type);
CREATE INDEX idx_activity_logs_created_at ON public.tbl_activity_logs USING btree (created_at DESC);
CREATE INDEX idx_activity_logs_status ON public.tbl_activity_logs USING btree (activity_status);
CREATE INDEX idx_activity_logs_user_session ON public.tbl_activity_logs USING btree (user_id, session_id, created_at DESC);
COMMENT ON TABLE tbl_activity_logs IS 'Activity logs for conversation tracking and analytics';
COMMENT ON COLUMN tbl_activity_logs.activity_type IS 'Type: message_sent, retrieval_executed, retrieval_skipped, token_overflow, llm_error, etc';
COMMENT ON COLUMN tbl_activity_logs.processing_time_ms IS 'Total time from request to response in milliseconds';
```

```sql
-- MAIN CORE DMS.
CREATE TABLE "TblCategories"(
    "Id" integer GENERATED ALWAYS AS IDENTITY NOT NULL,
    "CategoryName" varchar(100) NOT NULL,
    "CategoryDesc" text,
    "Owner" integer NOT NULL,
    "ParentId" integer,
    "IsNeedApproval" boolean NOT NULL,
    "InsertedBy" integer NOT NULL,
    "InsertedAt" timestamp without time zone NOT NULL,
    "UpdatedBy" integer,
    "UpdatedAt" timestamp without time zone NOT NULL,
    "IsActive" boolean NOT NULL,
    "IsDeleted" boolean NOT NULL,
    "DeletedBy" varchar(50),
    "DeletedAt" timestamp without time zone,
    PRIMARY KEY(Id),
    CONSTRAINT FK_TblCategories_TblCategories_ParentId FOREIGN key("ParentId") REFERENCES "TblCategories"("Id"),
    CONSTRAINT FK_TblCategories_TblMsUser_Owner FOREIGN key("Owner") REFERENCES "TblMsUser"("UserId")
);
CREATE INDEX "IX_TblCategories_Owner" ON public."TblCategories" USING btree ("Owner");
CREATE INDEX "IX_TblCategories_ParentId" ON public."TblCategories" USING btree ("ParentId");

CREATE TABLE "TblDocumentFiles"(
    "Id" integer GENERATED ALWAYS AS IDENTITY NOT NULL,
    "DocumentID" integer NOT NULL,
    "DocumentType" varchar(15) NOT NULL,
    "DocumentFileName" varchar(150) NOT NULL,
    "NewDocumentFileName" varchar(150),
    "DocumentFileSize" integer NOT NULL,
    "DocumentFileContent" text,
    "DocumentFilePath" varchar(1000) NOT NULL,
    "IsMainDocumentFile" boolean NOT NULL,
    "DocumentSummary" text,
    "Attributtes" text,
    "InsertedBy" integer NOT NULL,
    "UpdatedBy" integer,
    "SearchVector" tsvector GENERATED ALWAYS AS to_tsvector('english'::regconfig, COALESCE("DocumentFileContent", ''::text)) STORED,
    "InsertedAt" timestamp without time zone NOT NULL,
    "UpdatedAt" timestamp without time zone NOT NULL,
    "IsActive" boolean NOT NULL,
    "IsDeleted" boolean NOT NULL,
    "DeletedBy" varchar(50),
    "DeletedAt" timestamp without time zone,
    PRIMARY KEY(Id),
    CONSTRAINT FK_TblDocumentFiles_TblDocuments_DocumentID FOREIGN key("DocumentID") REFERENCES "TblDocuments"("Id"),
    CONSTRAINT FK_TblDocumentFiles_TblMsUser_InsertedBy FOREIGN key("InsertedBy") REFERENCES "TblMsUser"("UserId"),
    CONSTRAINT FK_TblDocumentFiles_TblMsUser_UpdatedBy FOREIGN key("UpdatedBy") REFERENCES "TblMsUser"("UserId")
);
CREATE INDEX "IX_TblDocumentFiles_DocumentID" ON public."TblDocumentFiles" USING btree ("DocumentID");
CREATE INDEX "IX_TblDocumentFiles_InsertedBy" ON public."TblDocumentFiles" USING btree ("InsertedBy");
CREATE INDEX "IX_TblDocumentFiles_SearchVector" ON public."TblDocumentFiles" USING gin ("SearchVector");
CREATE INDEX "IX_TblDocumentFiles_UpdatedBy" ON public."TblDocumentFiles" USING btree ("UpdatedBy");


CREATE TABLE "TblDocuments"(
    "Id" integer GENERATED ALWAYS AS IDENTITY NOT NULL,
    "CategoryID" integer NOT NULL,
    "DocumentTitle" varchar(250) NOT NULL,
    "DocumentDesc" varchar(1000),
    "Owner" integer NOT NULL,
    "FileSize" integer,
    "ExpiryDate" timestamp without time zone,
    "ReminderDays" smallint,
    "ReminderDateTime" timestamp without time zone,
    "WatermarkID" integer,
    "InsertedBy" integer NOT NULL,
    "InsertedAt" timestamp without time zone NOT NULL,
    "UpdatedBy" integer,
    "UpdatedAt" timestamp without time zone NOT NULL,
    "IsActive" boolean NOT NULL,
    "IsDeleted" boolean NOT NULL,
    "DeletedBy" varchar(50),
    "DeletedAt" timestamp without time zone,
    PRIMARY KEY(Id),
    CONSTRAINT FK_TblDocuments_TblCategories_CategoryID FOREIGN key("CategoryID") REFERENCES "TblCategories"("Id"),
    CONSTRAINT FK_TblDocuments_TblMsUser_Owner FOREIGN key("Owner") REFERENCES "TblMsUser"("UserId"),
    CONSTRAINT FK_TblDocuments_TblWatermarks_WatermarkID FOREIGN key("WatermarkID") REFERENCES "TblWatermarks"("Id")
);
CREATE INDEX "IX_TblDocuments_CategoryID" ON public."TblDocuments" USING btree ("CategoryID");
CREATE INDEX "IX_TblDocuments_Owner" ON public."TblDocuments" USING btree ("Owner");
CREATE INDEX "IX_TblDocuments_WatermarkID" ON public."TblDocuments" USING btree ("WatermarkID");
CREATE INDEX idx_vw_user_docs_document_id ON public."TblDocuments" USING btree ("Id");


CREATE TABLE "TblDocumentSharedPrivillege"(
    "Id" integer GENERATED ALWAYS AS IDENTITY NOT NULL,
    "DocumentSharedID" integer NOT NULL,
    "ShareType" varchar(5) NOT NULL,
    "UserID" integer,
    "GroupID" integer,
    "IsView" boolean NOT NULL,
    "IsEdit" boolean NOT NULL,
    "IsDelete" boolean NOT NULL,
    "InsertedBy" integer NOT NULL,
    "InsertedAt" timestamp without time zone NOT NULL,
    "UpdatedBy" integer,
    "UpdatedAt" timestamp without time zone NOT NULL,
    "IsActive" boolean NOT NULL,
    "IsDeleted" boolean NOT NULL,
    "DeletedBy" varchar(50),
    "DeletedAt" timestamp without time zone,
    PRIMARY KEY(Id),
    CONSTRAINT FK_TblDocumentSharedPrivillege_TblDocumentShared_DocumentShare~ FOREIGN key("DocumentSharedID") REFERENCES "TblDocumentShared"("Id"),
    CONSTRAINT FK_TblDocumentSharedPrivillege_TblMsGroup_GroupID FOREIGN key("GroupID") REFERENCES "TblMsGroup"("GroupId"),
    CONSTRAINT FK_TblDocumentSharedPrivillege_TblMsUser_UserID FOREIGN key("UserID") REFERENCES "TblMsUser"("UserId")
);
CREATE INDEX "IX_TblDocumentSharedPrivillege_DocumentSharedID" ON public."TblDocumentSharedPrivillege" USING btree ("DocumentSharedID");
CREATE INDEX "IX_TblDocumentSharedPrivillege_GroupID" ON public."TblDocumentSharedPrivillege" USING btree ("GroupID");
CREATE INDEX "IX_TblDocumentSharedPrivillege_UserID" ON public."TblDocumentSharedPrivillege" USING btree ("UserID");
CREATE INDEX idx_vw_user_docs_user_id ON public."TblDocumentSharedPrivillege" USING btree ("UserID");

CREATE TABLE "TblDocumentShared"(
    "Id" integer GENERATED ALWAYS AS IDENTITY NOT NULL,
    "DocumentID" integer NOT NULL,
    "InsertedBy" integer NOT NULL,
    "InsertedAt" timestamp without time zone NOT NULL,
    "UpdatedBy" integer,
    "UpdatedAt" timestamp without time zone NOT NULL,
    "IsActive" boolean NOT NULL,
    "IsDeleted" boolean NOT NULL,
    "DeletedBy" varchar(50),
    "DeletedAt" timestamp without time zone,
    PRIMARY KEY(Id),
    CONSTRAINT FK_TblDocumentShared_TblDocuments_DocumentID FOREIGN key("DocumentID") REFERENCES "TblDocuments"("Id")
);
CREATE INDEX "IX_TblDocumentShared_DocumentID" ON public."TblDocumentShared" USING btree ("DocumentID");
```
